<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
    <script type="text/javascript">
        WebFontConfig = { fontdeck: { id: '57741' } };
        (function() {
            var wf = document.createElement('script');
            wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
            '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
            wf.type = 'text/javascript';
            wf.async = 'true';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(wf, s);
        })();
    </script>

    <style>
      .instructions, .credits {
          font-family: "PT Sans Regular", "Arial Unicode", "Lucida Sans Unicode", Arial, sans-serif;
          padding: 10px 20px;
          margin-bottom: 10px;
          background: #EEE;
      }
      .instructions {
          font-size: 14pt;
      }
      .credits {
          font-size: 10pt;
      }
      p.nav {
          font-family: "Skolar3 PE Regular", Georgia, serif;
          margin-bottom: 1em;
          font-size: 14pt;
          margin-top: 1em;
      }
      .alert {
        font-family: "Skolar3 PE Regular", Georgia, serif;
      }
      .alert h2 {
          margin-top: 0;
          margin-bottom: 0;
      }
      .alert h3 {
          margin-top: 10px;
          margin-bottom: 0;
      }
      p.nav a {
          color: #C00;
          text-decoration: none;
          font-family: "PT Sans Regular", "Arial Unicode", "Lucida Sans Unicode", Arial, sans-serif;
          font-size: 14pt;
      }
      .legend {
          text-align: center;
      }
      .legend span {
          font-family: "PT Sans Regular", "Arial Unicode", "Lucida Sans Unicode", Arial, sans-serif;
          font-size: 10pt;
          padding: 8px 12px;
          color: #FFF;
          background: #CCC;
      }
      .text {
          margin-top: 50px;
          font-family: "Skolar3 PE Regular", Georgia, serif;
          font-size: 20pt;
          line-height: 30pt;
          word-spacing: 6pt;
          color: #333;
      }
      .details {
        margin-top: 50px;
      }
      .book-link, .paragraph-link {
          cursor: pointer;
      }
      .navigation {
          margin: 20px 0;
          font-size: 14pt;
          font-family: "PT Sans Regular", "Arial Unicode", "Lucida Sans Unicode", Arial, sans-serif;
      }
      .prev {
          float: left;
      }
      .next {
          float: right;
      }
      i {
          font-style: normal;
          position: relative;
          cursor: pointer;
          display: inline-block;
          margin-right: 0.3em;
      }
      .lemma {
        cursor: pointer;
      }
      i.active {
        color: #C00;
      }
      i.highlight {
        color: #0C0;
      }
      i.highlight-2 {
        color: #00C;
      }
  </style>
  </head>
  <body>
    <div class="container">
      <p class="nav">
          J. K. Tauber | <a href="/labs/">Labs</a>
      </p>

      <div class="row">
        <div class="col-md-3"></div>
        <div class="col-md-6 text">
          <div id="load"></div>
        </div>
        <div class="col-md-3 details">
          <div id="word"></div>
        </div>
      </div>
    </div>
    <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/mustache.js/2.1.2/mustache.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>
    <script id="template_paragraph" type="x-tmpl-mustache">
        {{#words}}
            <i data-word_id="{{word_id}}" data-rel="{{rel}}" data-head="{{head}}" data-lexeme_id="{{lexeme_id}}" data-form_id="{{form_id}}">{{text}}</i>
        {{/words}}
    </script>
    <script id="template_word" type="x-tmpl-mustache">
      <div class="alert alert-dismissible" role="alert">
          <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h2>{{form}}</h2>
          <div>{{parse}}</div>
          <h3 class="lemma" data-lexeme_id="{{lexeme_id}}">{{lemma}}</h3>
          <div>{{pos}}</div>
          <div>&ldquo;{{gloss}}&rdquo;</div>
          <div>{{rel}} of <span class="head" data-head_word_id="{{head_word_id}}">{{head_word}}</div>
      </div>
    </script>
    <script type="text/javascript">
      var fetchData = function (url) {
        var json = null;
        $.ajax({
            async: false,
            global: false,
            url: url,
            dataType: "json",
            success: function (data) {
                json = data;
            }
        });
        return json;
      }
      $(function () {
        var template_paragraph = $("#template_paragraph").html();
        var template_word = $("#template_word").html();
        var forms = fetchData("/forms.json");
        var lexemes = fetchData("/lexemes.json");
        $.getJSON("/base.json", function (data) {
          $.each(data, function (i, w) {
            w.lexeme_id = forms[w.form_id].lexeme_id;
          })
          $("#load").html(Mustache.to_html(template_paragraph, {words: data}));
          $("#load i").on("click", function () {
            var $word = $(this),
                form = forms[$word.data("form_id")],
                lexeme = lexemes[form.lexeme_id],
                word_id = $word.data("word_id"),
                rel = $word.data("rel"),
                head = $word.data("head"),
                head_word = data.filter(function (word) {return parseInt(word.word_id) === head;})[0],
                word = $word.text();
            $("#load i").toggleClass("highlight", false);
            $("#load i").toggleClass("active", false);
            $word.toggleClass("active", true);
            $("#word").html(Mustache.to_html(template_word, {
              word: word,
              word_id: word_id,
              form: form.form,
              form_id: $word.data("form_id"),
              lexeme_id: form.lexeme_id,
              lemma: lexeme.lemma,
              parse: form.parse,
              pos: lexeme.pos,
              gloss: lexeme.gloss,
              rel: rel,
              head: head,
              head_word: head_word ? forms[head_word.form_id].form : "",
              head_word_id: head_word ? head_word.word_id : ""
            }));
            $('.alert').on('closed.bs.alert', function () {
              $("#load i").toggleClass("highlight", false);
              $("#load i").toggleClass("active", false);
            });
          });
          $("#word").on("click", ".lemma", function () {
            var lexeme_id = $(this).data("lexeme_id");
            $("i[data-lexeme_id=" + lexeme_id + "]").toggleClass("highlight");
          });
          $("#word").on("mouseover", ".head", function () {
            var word_id = $(this).data("head_word_id");
            $("i[data-word_id=" + word_id + "]").toggleClass("highlight-2");
          });
          $("#word").on("mouseout", ".head", function () {
            var word_id = $(this).data("head_word_id");
            $("i[data-word_id=" + word_id + "]").toggleClass("highlight-2");
          });
        });
      });
    </script>
  </body>
</html>
